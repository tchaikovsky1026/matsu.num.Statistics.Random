# `DirichletBasedBinomialRnd` に関する資料

## 原理

二項乱数の生成について, 次の原理を基にしている：
$n$を非負整数, $p$を$0 \le p \le 1$の実数とする.
確率変数$(X_0,...,X_n)$が集中度パラメータが1のDirichlet分布に従うとき,
$Z$を

```math
Z = \text{「$X_0 + \cdots + X_k \ge p$となる最小の$k$」}
```

とすれば, $Z\sim\mathrm{Bin}(n,p)$である.

`DirichletBasedBinomialRnd` では,
$n+1$変数の集中度パラメータが1のDirichlet分布の確率変数をいくつかのグループに分け,
集中度母数が2の累乗と端数の集中度パラメータを持つDirichlet分布の確率変数に帰着させることで,
確率変数の個数を$O(\log n)$に減らしている.
その後, 各グループについて処理を行いシフトをする.
グループの判定やシフト量は, 以下に示した2の累乗パターンと似たものである
(メモのため, ここでは詳細を述べない).
グルーピングは$n+1$の2進展開で求まる.

2の累乗の集中度パラメータのグループは, 試行回数が小さくなるまで次のアルゴリズムを再帰的に用い,
その後, 素朴な方法により発生させる.

**$\mathrm{Bin}(2^N-1,p)$に従う乱数の生成**

1. 集中度パラメータが$2^{N-1}$の2変数Dirichlet乱数を生成し, $x_1,x_2$とする.
2. - $x_1 \ge p$ の場合は, $\mathrm{Bin}(2^{N-1}-1, \frac{p}{x_1})$により発生させた乱数を返す.
   - $x_1 < p$ の場合は, $\mathrm{Bin}(2^{N-1}-1, \frac{p-x_1}{x_2})$により発生させた乱数に$2^{N-1}$を加えて返す.
